version: 1.0
runtime: nodejs18
build:
  commands:
    pre-build:
      - cd ../../packages/shared && npm install --include=dev --workspaces=false --install-links --no-audit --no-fund && npm run build
      - npm install --include=dev --workspaces=false --install-links --no-audit --no-fund
      - node -e "console.log('shared entry path=', require.resolve('@proof/shared'))"
      - node -e "const fs=require('fs'); console.log('shared dist exists=', fs.existsSync('node_modules/@proof/shared/dist/index.js'))"
      - node -e "import('@proof/shared').then(()=>console.log('import @proof/shared OK')).catch(e=>{console.error('import @proof/shared FAILED'); console.error(e); process.exit(1);})"
    build:
      - npm run build
run:
  # Let App Runner provide PORT; server.ts already defaults to 8080 if PORT isn't set.
  command: npm start
  network:
    port: 8080
